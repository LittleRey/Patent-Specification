<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <script>
        function tagText(arr, text, bracketFlag) {
            if (bracketFlag) {
                for (var i = 0; i < arr.length; i++) {
                    var flag = true;
                    var num = 0;
                    var len = 0;
                    while (flag) {
                        var index = text.indexOf(arr[i][1], num + len);
                        if (index === -1) {
                            flag = false;
                        } else {
                            var numeralText = '（' + arr[i][0] + '）';
                            len = arr[i][1].length;
                            num = index;
                            if (i === 0) {
                                text = text.slice(0, index + len) + numeralText + text.slice(index + len);
                            } else {
                                var bracketIndex = text.indexOf('（', index);
                                console.log(bracketIndex);
                                var words = text.slice(bracketIndex - arr[i - 1][1].length, bracketIndex);
                                console.log(words);
                                if (bracketIndex == -1) {
                                    
                                }
                                if (words !== arr[i - 1][1]) {
                                    text = text.slice(0, index + len) + numeralText + text.slice(index + len);
                                }
                            }
                        }
                    }
                }
                if (text === '') {
                    return [];
                } else {
                    var textArr = text.split(/\n/);
                    return textArr;
                }
            } else {
                for (var i = 0; i < arr.length; i++) {
                    var flag = true;
                    var num = 0;
                    var len = 0;
                    while (flag) {
                        var index = text.indexOf(arr[i][1], num + len);
                        if (index === -1) {
                            flag = false;
                        } else {
                            var numeralText = '' + arr[i][0];
                            len = arr[i][1].length;
                            num = index;
                            if (i === 0) {
                                text = text.slice(0, index + len) + numeralText + text.slice(index + len);
                            } else {
                                if (index !== text.indexOf(arr[i - 1][1], index)) {
                                    text = text.slice(0, index + len) + numeralText + text.slice(index + len);
                                }
                            }
                        }
                    }
                }
                if (text === '') {
                    return [];
                } else {
                    var textArr = text.split(/\n/);
                    return textArr.map(function (val) {
                        if (val.indexOf('根据权利要求') !== -1) {
                            return val.slice(val.indexOf('，') + 1);
                        } else {
                            return val;
                        }
                    });
                }
            }
        }

        console.log(tagText([
            ['3', '螺栓座底'],
            ['2', '螺栓座'],
            ['1', '螺栓']
        ], '所述螺栓的螺栓座，螺栓座底有个螺栓座，螺栓座有个螺栓', true));
    </script>
</body>

</html>